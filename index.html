<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Türkiye Finansal Hafıza & Alım Gücü 3.0</title>
    <meta name="description" content="Türkiye'nin ekonomik tarihçesi, 1998-2026 alım gücü karşılaştırmaları.">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Roboto', sans-serif; }
        
        select {
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%234b5563' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat; background-position: right 1rem center; background-size: 1em;
        }
        .dark select {
             background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
        }

        .transition-smooth { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        .dark ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .dark ::-webkit-scrollbar-thumb { background: #334155; }

        .item-checkbox:checked + div {
            background-color: #f0fdf4; border-color: #22c55e; color: #15803d; font-weight: 600;
        }
        .dark .item-checkbox:checked + div {
            background-color: #052e16; border-color: #22c55e; color: #86efac;
        }
        
        /* News Ticker Animation */
        @keyframes ticker {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        .news-ticker-content {
            display: inline-block;
            white-space: nowrap;
            animation: ticker 30s linear infinite;
        }
        
        /* Share Button Styles */
        .share-btn {
            display: inline-flex; align-items: center; justify-content: center;
            padding: 0.5rem 1rem; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 600;
            transition: all 0.2s; color: white;
        }
        .share-twitter { background-color: #000000; color: #ffffff !important; -webkit-text-fill-color: #ffffff; }
        .share-twitter:hover { background-color: #333333; }
        .share-facebook { background-color: #1877F2; }
        .share-facebook:hover { background-color: #166fe5; }
        .share-whatsapp { background-color: #25D366; }
        .share-whatsapp:hover { background-color: #1ebc57; }
        .share-linkedin { background-color: #0A66C2; }
        .share-linkedin:hover { background-color: #084e96; }

        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="text-slate-800 dark:text-slate-100 dark:bg-slate-900 antialiased flex flex-col min-h-screen transition-colors duration-300">

    <!-- Header -->
    <header class="bg-white dark:bg-slate-900 shadow-sm border-b border-slate-200 dark:border-slate-800 sticky top-0 z-50 transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="bg-orange-600 text-white w-9 h-9 rounded-lg flex items-center justify-center font-bold shadow-sm">
                    <i class="fa-solid fa-chart-line"></i>
                </div>
                <h1 class="text-xl font-black text-slate-900 dark:text-white tracking-tight">FİNANS<span class="text-orange-600">HAFIZA</span></h1>
            </div>
            
            <div class="hidden md:flex items-center gap-8 text-sm font-semibold text-slate-500 dark:text-slate-400">
                <a href="#analiz" class="hover:text-orange-600 dark:hover:text-orange-500 transition-colors py-2">Analizler</a>
                <!-- Gündem & Haberler Removed -->
                <!-- Premium Button Removed -->
            </div>
            
            <button class="md:hidden text-slate-600 dark:text-slate-400 text-xl"><i class="fa-solid fa-bars"></i></button>
        </div>
    </header>

    <!-- Breaking News Bar Removed -->

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 flex-grow">

        <!-- Intro -->
        <div class="mb-10 text-center md:text-left">
            <h2 class="text-3xl md:text-4xl font-extrabold text-slate-900 dark:text-white mb-3 tracking-tight">Ekonomik Hafıza & Gündem</h2>
            <p class="text-slate-500 dark:text-slate-400 text-lg max-w-2xl">Geçmişten bugüne alım gücü analizi ve güncel ekonomik veriler.</p>
        </div>

        <!-- Control Panel -->
        <!-- AD SPACE: TOP BANNER -->
        <!-- <div class="w-full h-32 bg-slate-100 dark:bg-slate-800 flex items-center justify-center mb-8 rounded-xl border border-slate-200 dark:border-slate-700 text-slate-400 font-bold">REKLAM ALANI (970x90)</div> -->

        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl border border-slate-100 dark:border-slate-700 p-6 md:p-8 mb-10 relative overflow-hidden transition-colors duration-300" id="analiz">
            <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-slate-200 dark:from-slate-700 via-orange-500 to-slate-200 dark:to-slate-700"></div>

            <div class="grid grid-cols-1 md:grid-cols-10 gap-6 items-end">
                
                <!-- Date Selector -->
                <div class="md:col-span-3 w-full space-y-2">
                    <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider">Hesaplama Yılı</label>
                    <div class="relative">
                        <select id="yearSelect" class="w-full h-14 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-700 text-slate-900 dark:text-white text-base rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 block px-4 font-medium transition-smooth shadow-sm cursor-pointer">
                            <option value="1998">1998 (6 Sıfır Öncesi)</option>
                            <option value="2002">2002 (Kriz Sonrası)</option>
                            <option value="2010">2010 (İstikrar Dönemi)</option>
                            <option value="2016">2016 (Kırılma Yılı)</option>
                            <option value="2020">2020 (Pandemi)</option>
                            <option value="2024">2024 (Geçen Yıl)</option>
                        </select>
                    </div>
                </div>

                <!-- Salary Segment Selector -->
                <div class="md:col-span-4 w-full space-y-2">
                    <label class="block text-xs font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider">Gelir Grubu / Baz Maaş</label>
                    <div class="relative">
                        <select id="salarySelect" class="w-full h-14 bg-slate-50 dark:bg-slate-900 border border-slate-300 dark:border-slate-700 text-slate-900 dark:text-white text-base rounded-xl focus:ring-2 focus:ring-orange-500 focus:border-orange-500 block px-4 font-medium transition-smooth shadow-sm cursor-pointer">
                            <option value="asgari">Asgari Ücret (Net)</option>
                            <option value="emekli">En Düşük Emekli Maaşı</option>
                            <option value="memur">Ortalama Memur Maaşı</option>
                            <option value="doktor">Uzman Doktor (1/4)</option>
                            <option value="polis">Polis Memuru (8/1)</option>
                        </select>
                    </div>
                </div>

                <!-- Action Button -->
                <div class="md:col-span-3 w-full">
                    <button onclick="calculateData()" class="w-full h-14 bg-orange-600 hover:bg-orange-700 active:bg-orange-800 text-white font-bold rounded-xl shadow-lg hover:shadow-orange-500/30 transition-smooth flex justify-center items-center gap-3 text-lg">
                        HESAPLA (vs 2026) <i class="fa-solid fa-arrow-right-long"></i>
                    </button>
                </div>
            </div>

            <!-- Item Filters -->
            <div class="mt-8 pt-6 border-t border-slate-100 dark:border-slate-700">
                <label class="block text-xs font-bold text-slate-400 uppercase mb-4">Kıyaslanacak Veriler (Çoklu Seçim Yapabilirsiniz)</label>
                <div class="flex flex-wrap gap-3" id="itemFilters">
                    <!-- Filters injected by JS -->
                </div>
            </div>
        </div>

        <!-- Placeholder -->
        <div id="placeholderState" class="text-center py-24 bg-white dark:bg-slate-800 rounded-2xl border-2 border-dashed border-slate-200 dark:border-slate-700 transition-colors duration-300">
            <div class="w-20 h-20 bg-slate-50 dark:bg-slate-900 rounded-full flex items-center justify-center mx-auto mb-6 shadow-inner">
                <i class="fa-solid fa-chart-pie text-3xl text-slate-300 dark:text-slate-600"></i>
            </div>
            <h3 class="text-xl font-bold text-slate-700 dark:text-white">Analiz Başlatın</h3>
            <p class="text-slate-400 mt-2">Lütfen yukarıdan bir yıl ve maaş grubu seçerek hesaplamayı başlatın.</p>
        </div>

        <!-- Results Section -->
        <div id="resultsArea" class="hidden animate-fade-in space-y-10">
            
            <!-- AD SPACE: MID CONTENT -->
            <!-- <div class="w-full h-32 bg-slate-100 dark:bg-slate-800 flex items-center justify-center rounded-xl border border-slate-200 dark:border-slate-700 text-slate-400 font-bold">REKLAM ALANI (Responsive)</div> -->

            <!-- Share Section -->
            <div class="flex flex-wrap justify-between items-center gap-4 bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm transition-colors duration-300">
                <div class="text-sm font-bold text-slate-500 dark:text-slate-400 uppercase tracking-wider">
                    <i class="fa-solid fa-share-nodes mr-2"></i> Analizi Paylaş
                </div>
                <div class="flex gap-2">
                    <button onclick="shareResult('twitter')" class="share-btn share-twitter text-white"><i class="fa-brands fa-x-twitter"></i></button>
                    <button onclick="shareResult('facebook')" class="share-btn share-facebook">Facebook</button>
                    <button onclick="shareResult('whatsapp')" class="share-btn share-whatsapp">WhatsApp</button>
                    <button onclick="shareResult('linkedin')" class="share-btn share-linkedin">LinkedIn</button>
                </div>
            </div>

            <!-- Dynamic Charts Container -->
            <div id="chartsContainer" class="space-y-8">
                <!-- Charts or Warnings will be injected here -->
            </div>

            <!-- Detailed Grid Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-5" id="itemsGrid">
                <!-- Small Cards injected here -->
            </div>

            <!-- Error Reporting Section (Kept standalone or moved) -->
             <div class="max-w-2xl mx-auto mt-12">
                <div class="bg-slate-50 dark:bg-slate-800 rounded-xl p-6 border border-slate-200 dark:border-slate-700 text-center transition-colors duration-300">
                    <div class="font-bold text-slate-800 dark:text-white mb-2 flex items-center justify-center gap-2">
                        <i class="fa-solid fa-triangle-exclamation text-red-500"></i> Veri Hatası mı?
                    </div>
                    <p class="text-sm text-slate-500 dark:text-slate-400 mb-4">Tarihsel verilerde bir yanlışlık fark ettiyseniz lütfen bize bildirin.</p>
                    <button onclick="openModal('errorModal')" class="bg-white dark:bg-slate-700 border border-red-200 dark:border-red-900 text-red-600 dark:text-red-400 font-bold py-2 px-6 rounded-lg text-sm hover:bg-red-50 dark:hover:bg-slate-600 transition-colors shadow-sm">
                        Hata Bildir
                    </button>
                </div>
            </div>

        </div>

    </main>

    <!-- AD SPACE: FOOTER BANNER -->
    <!-- <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-8"><div class="w-full h-32 bg-slate-100 flex items-center justify-center rounded-xl border border-slate-200 text-slate-400 font-bold">REKLAM ALANI (Responsive)</div></div> -->

    <!-- Footer -->
    <footer class="bg-white dark:bg-slate-900 border-t border-slate-200 dark:border-slate-800 py-8 mt-12 transition-colors duration-300">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-sm text-slate-500 dark:text-slate-400 max-w-3xl mx-auto leading-relaxed">
                <i class="fa-solid fa-circle-check text-green-500 mr-1"></i>
                <strong>Veri Kaynakları:</strong> TCMB, TÜİK, Petrol Ofisi Arşiv, Altınkaynak, CoinMarketCap ve Yerelsen Veriler. <br>
                <span class="text-xs block mt-2 opacity-75">* 2005 öncesi veriler YTL dönüşümü yapılarak hesaplanmıştır. Kripto varlıklar için ilgili tarihteki açılış fiyatları baz alınır.</span>
            </p>
            <p class="text-sm font-bold text-slate-800 dark:text-slate-300 mt-6">FİNANS HAFIZA &copy; 2026</p>
        </div>
    </footer>

    <!-- Premium Modal Removed -->

    <!-- Error Reporting Modal -->
    <div id="errorModal" class="fixed inset-0 bg-slate-900/80 z-[100] hidden flex items-center justify-center backdrop-blur-sm p-4">
        <div class="bg-white dark:bg-slate-800 rounded-3xl p-8 max-w-md w-full relative shadow-2xl">
            <button onclick="closeModal('errorModal')" class="absolute top-5 right-5 text-slate-400 hover:text-slate-600 dark:hover:text-slate-300 w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors"><i class="fa-solid fa-xmark text-lg"></i></button>
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center text-red-600 dark:text-red-400">
                    <i class="fa-solid fa-bug"></i>
                </div>
                <h3 class="text-xl font-bold text-slate-900 dark:text-white">Hata Bildir</h3>
            </div>
            <form onsubmit="event.preventDefault(); alert('Geri bildiriminiz alındı. Teşekkürler!'); closeModal('errorModal');" class="space-y-4">
                <textarea class="w-full border border-slate-300 dark:border-slate-600 bg-slate-50 dark:bg-slate-900 dark:text-white p-3 rounded-xl text-sm h-32 outline-none focus:ring-2 focus:ring-red-500 resize-none" placeholder="Hangi veri hatalı?"></textarea>
                <button type="submit" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3.5 rounded-xl shadow-md transition-colors">Bildirimi Gönder</button>
            </form>
        </div>
    </div>

    <script>
        // --- DATA ---
        // Veriler 2026 Ocak ayı güncel piyasa verileridir.
        // NST: ~112 TL, BTC: ~3.88M TL
        
        const historicalData = {
            "1998": {
                note: "6 Sıfır Öncesi",
                salaries: { asgari: 29.1, emekli: 45, memur: 90, doktor: 180, polis: 110 }, 
                items: {
                    ceyrek: 3.8, benzin: 0.21, gram: 2.2, dolar: 0.26, euro: 0.30, ekmek: 0.04, 
                    bira: 0.35, doner: 0.6, elektrik: 4, tavuk: 0.7, kuzu: 1.8, sut: 0.2, peynir: 1.0, 
                    zeytin: 0.9, kira_ist: 70, ev_ist: 10000, 
                    iphone: 0, bigmac: 0.6, btc: 0, nst: 0
                }
            },
            "2002": {
                note: "Kriz Sonrası",
                salaries: { asgari: 184.25, emekli: 257, memur: 578, doktor: 1100, polis: 650 },
                items: {
                    ceyrek: 32, gram: 18, dolar: 1.5, euro: 1.6, benzin: 1.48, ekmek: 0.25, 
                    bira: 1.5, doner: 2.5, elektrik: 30, tavuk: 3, kuzu: 8, sut: 1, peynir: 4, 
                    zeytin: 3, kira_ist: 200, ev_ist: 45000, 
                    iphone: 0, bigmac: 3, btc: 0, nst: 0
                }
            },
            "2010": {
                note: "İstikrar",
                salaries: { asgari: 599.12, emekli: 750, memur: 1600, doktor: 2800, polis: 2000 },
                items: {
                    ceyrek: 115, gram: 65, dolar: 1.5, euro: 2.0, benzin: 3.68, ekmek: 0.75, 
                    bira: 3, doner: 8, elektrik: 60, tavuk: 6, kuzu: 25, sut: 2, peynir: 12, 
                    zeytin: 10, kira_ist: 750, ev_ist: 150000, 
                    iphone: 1600, bigmac: 6, btc: 0.5, nst: 0 // BTC 2010'da vardı ama çok düşüktü, sembolik 0.5 TL
                }
            },
            "2016": {
                note: "Kırılma Yılı",
                salaries: { asgari: 1300.99, emekli: 1400, memur: 2600, doktor: 4500, polis: 3400 },
                items: {
                    ceyrek: 200, gram: 125, dolar: 3.0, euro: 3.3, benzin: 5.05, ekmek: 1.25, 
                    bira: 7, doner: 15, elektrik: 90, tavuk: 10, kuzu: 40, sut: 3, peynir: 20, 
                    zeytin: 18, kira_ist: 1500, ev_ist: 350000, 
                    iphone: 3500, bigmac: 10, btc: 2000, nst: 0
                }
            },
            "2020": {
                note: "Pandemi",
                salaries: { asgari: 2324.70, emekli: 1800, memur: 4200, doktor: 7000, polis: 5500 },
                items: {
                    ceyrek: 750, gram: 450, dolar: 7.0, euro: 8.5, benzin: 6.20, ekmek: 2, 
                    bira: 15, doner: 25, elektrik: 180, tavuk: 18, kuzu: 80, sut: 6, peynir: 45, 
                    zeytin: 35, kira_ist: 2500, ev_ist: 600000, 
                    iphone: 10000, bigmac: 20, btc: 60000, nst: 0
                }
            },
            "2024": {
                note: "Yüksek Enflasyon",
                salaries: { asgari: 17002.12, emekli: 12500, memur: 34000, doktor: 60000, polis: 44000 },
                items: {
                    ceyrek: 4500, gram: 2600, dolar: 33, euro: 36, benzin: 42.5, ekmek: 10, 
                    bira: 75, doner: 250, elektrik: 800, tavuk: 120, kuzu: 600, sut: 40, peynir: 350, 
                    zeytin: 300, kira_ist: 25000, ev_ist: 4500000, 
                    iphone: 65000, bigmac: 180, btc: 2200000, nst: 55
                }
            },
             "2026": { // 2026 Current Time (Jan 9)
                note: "Güncel (Ocak 2026)",
                salaries: { asgari: 28075, emekli: 18500, memur: 49000, doktor: 92000, polis: 62000 }, 
                items: {
                    ceyrek: 6301, gram: 3739, dolar: 43.89, euro: 51.82, benzin: 51, ekmek: 15,
                    bira: 110, doner: 400, elektrik: 1300, tavuk: 180, kuzu: 900, sut: 60, peynir: 500, 
                    zeytin: 450, kira_ist: 32000, ev_ist: 6000000, 
                    iphone: 89000, bigmac: 240, btc: 3887000, nst: 112 
                }
            }
        };

        const itemLabels = {
            ceyrek: { label: "Çeyrek Altın", unit: "Adet", icon: "fa-coins", source: "Altınkaynak" },
            gram: { label: "Gram Altın", unit: "Gr", icon: "fa-ring", source: "BIST" },
            dolar: { label: "Dolar (USD)", unit: "Adet ($)", icon: "fa-dollar-sign", source: "TCMB" },
            euro: { label: "Euro", unit: "Adet (€)", icon: "fa-euro-sign", source: "TCMB" },
            btc: { label: "Bitcoin (BTC)", unit: "BTC", icon: "fa-brands fa-bitcoin", source: "CoinMarketCap" },
            nst: { label: "Ninja Squad (NST)", unit: "Adet", icon: "fa-solid fa-user-ninja", source: "CoinMarketCap" },
            iphone: { label: "iPhone (Baz)", unit: "Adet", icon: "fa-mobile-screen", source: "Apple" },
            ekmek: { label: "Ekmek", unit: "Adet", icon: "fa-bread-slice", source: "Fırıncılar O." },
            benzin: { label: "Benzin", unit: "Lt", icon: "fa-gas-pump", source: "Petrol Ofisi" },
            kira_ist: { label: "Kira (İst)", unit: "Ay", icon: "fa-house-chimney", source: "Emlak Endeksi" },
            bira: { label: "Bira (50cl)", unit: "Adet", icon: "fa-beer-mug-empty", source: "Market Arşivi" },
            doner: { label: "Döner Porsiyon", unit: "Pors.", icon: "fa-utensils", source: "Lokantalar O." },
            elektrik: { label: "Elektrik", unit: "Fat.", icon: "fa-bolt", source: "EPDK" },
            tavuk: { label: "1kg Tavuk", unit: "Kg", icon: "fa-drumstick-bite", source: "TÜİK" },
            kuzu: { label: "1kg Kuzu Eti", unit: "Kg", icon: "fa-cow", source: "Et Süt K." },
            sut: { label: "1kg Süt", unit: "Lt", icon: "fa-bottle-water", source: "USK" },
            peynir: { label: "1kg Peynir", unit: "Kg", icon: "fa-cheese", source: "TÜİK" },
            zeytin: { label: "1kg Zeytin", unit: "Kg", icon: "fa-bowl-rice", source: "TÜİK" },
            ev_ist: { label: "Ev (İst)", unit: "Adet", icon: "fa-building", source: "GYODER" },
            bigmac: { label: "Big Mac", unit: "Adet", icon: "fa-burger", source: "Economist" }
        };

        // --- INIT ---
        function initFilters() {
            const container = document.getElementById('itemFilters');
            Object.keys(itemLabels).forEach(key => {
                const isDefault = ['ceyrek', 'ekmek', 'benzin'].includes(key);
                const wrapper = document.createElement('label');
                wrapper.className = "cursor-pointer group relative";
                
                const checkbox = document.createElement('input');
                checkbox.type = "checkbox";
                checkbox.className = "item-checkbox absolute opacity-0 w-0 h-0";
                checkbox.dataset.key = key;
                checkbox.checked = isDefault;

                const display = document.createElement('div');
                display.className = "border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 px-3 py-2 rounded-lg text-sm font-medium transition-all group-hover:border-orange-300 dark:group-hover:border-orange-500 select-none shadow-sm flex items-center gap-2";
                display.innerHTML = `<i class="${itemLabels[key].icon} text-slate-400 dark:text-slate-500"></i> ${itemLabels[key].label}`;

                wrapper.appendChild(checkbox);
                wrapper.appendChild(display);
                container.appendChild(wrapper);
            });
        }

        // --- CALCULATION ---
        let charts = [];
        let currentShareText = ""; 

        function calculateData() {
            const selectedYear = document.getElementById('yearSelect').value;
            const salaryType = document.getElementById('salarySelect').value;
            const currentYear = "2026"; 

            const salaryPast = historicalData[selectedYear].salaries[salaryType];
            const salaryNow = historicalData[currentYear].salaries[salaryType];

            const checkboxes = document.querySelectorAll('.item-checkbox:checked');
            const selectedItems = Array.from(checkboxes).map(el => el.dataset.key);

            if (selectedItems.length === 0) {
                alert("Lütfen en az bir ürün seçiniz.");
                return;
            }

            document.getElementById('placeholderState').classList.add('hidden');
            document.getElementById('resultsArea').classList.remove('hidden');

            const chartsContainer = document.getElementById('chartsContainer');
            chartsContainer.innerHTML = ''; 
            charts.forEach(c => c.destroy());
            charts = [];
            
            const salarySelect = document.getElementById('salarySelect');
            const salaryText = salarySelect.options[salarySelect.selectedIndex].text;

            // Build Share Text
            currentShareText = `Finansal Hafıza Raporu\n${salaryText} verisine göre ${selectedYear} yılında`;

            selectedItems.forEach((key, index) => {
                const pricePast = historicalData[selectedYear].items[key];
                const priceNow = historicalData[currentYear].items[key];
                
                // --- MISSING DATA LOGIC ---
                // If price is 0 or undefined, show "Data Not Found" card
                if (!pricePast || pricePast === 0) {
                     const errorHtml = `
                     <div class="bg-slate-100 dark:bg-slate-800 rounded-2xl p-6 border border-slate-200 dark:border-slate-700 border-dashed flex flex-col items-center justify-center text-center h-64">
                        <div class="w-16 h-16 bg-slate-200 dark:bg-slate-700 rounded-full flex items-center justify-center mb-4 text-slate-400">
                            <i class="${itemLabels[key].icon} text-3xl"></i>
                        </div>
                        <h3 class="font-bold text-slate-700 dark:text-white text-lg mb-1">${itemLabels[key].label}</h3>
                        <p class="text-slate-500 dark:text-slate-400 text-sm max-w-xs">
                            <span class="font-bold text-orange-600">${selectedYear}</span> yılında bu ürün piyasada bulunmuyordu veya güvenilir veri kaynağı yok.
                        </p>
                     </div>
                     `;
                     chartsContainer.innerHTML += errorHtml;
                     return; // Skip chart creation
                }

                const countPast = (salaryPast / pricePast).toFixed(2);
                const countNow = (salaryNow / priceNow).toFixed(2);

                currentShareText += ` ${countPast} ${itemLabels[key].unit} ${itemLabels[key].label} alınırken 2026 yılında ${countNow} ${itemLabels[key].unit} ${itemLabels[key].label} alınabiliyor.\n`;

                const wrapperId = `chart-wrapper-${index}`;
                const canvasId = `canvas-${index}`;

                const salaryDisplayPast = formatMoney(salaryPast, selectedYear);
                const salaryDisplayNow = formatMoney(salaryNow, currentYear);
                const priceDisplayPast = formatMoney(pricePast, selectedYear);
                const priceDisplayNow = formatMoney(priceNow, currentYear);

                const html = `
                <div class="bg-slate-900 rounded-2xl p-6 md:p-8 text-white shadow-2xl relative overflow-hidden group border border-slate-700" id="${wrapperId}">
                     <div class="absolute right-0 top-0 h-full w-2/3 bg-gradient-to-l from-slate-800 to-transparent opacity-50 group-hover:opacity-60 transition-opacity"></div>
                     <div class="absolute -right-10 -bottom-10 text-9xl text-white opacity-5"><i class="${itemLabels[key].icon}"></i></div>

                     <div class="flex flex-col md:flex-row gap-8 relative z-10">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-6">
                                <div class="w-10 h-10 rounded-lg bg-orange-600 flex items-center justify-center shadow-lg shadow-orange-900/50"><i class="${itemLabels[key].icon} text-lg"></i></div>
                                <div>
                                    <h3 class="font-black text-xl tracking-tight">${itemLabels[key].label}</h3>
                                    <div class="text-xs text-slate-400 font-medium bg-slate-800 px-2 py-0.5 rounded inline-block mt-1">Kaynak: ${itemLabels[key].source}</div>
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700/50 backdrop-blur-sm">
                                    <div class="text-orange-400 text-xs font-bold uppercase tracking-wider mb-2">${selectedYear} Verileri</div>
                                    <div class="space-y-1">
                                        <div class="text-sm text-slate-300 flex justify-between"><span>Maaş:</span> <span class="font-mono text-white">${salaryDisplayPast}</span></div>
                                        <div class="text-sm text-slate-300 flex justify-between"><span>Fiyat:</span> <span class="font-mono text-white">${priceDisplayPast}</span></div>
                                    </div>
                                    <div class="mt-3 pt-3 border-t border-slate-700">
                                        <div class="text-3xl font-black text-orange-500">${countPast} <span class="text-sm font-medium text-slate-400">${itemLabels[key].unit}</span></div>
                                        <div class="text-[10px] text-slate-500">Alım Gücü</div>
                                    </div>
                                </div>
                                <div class="bg-slate-800/50 p-4 rounded-xl border border-slate-700/50 backdrop-blur-sm">
                                    <div class="text-white text-xs font-bold uppercase tracking-wider mb-2">${currentYear} Verileri</div>
                                    <div class="space-y-1">
                                        <div class="text-sm text-slate-300 flex justify-between"><span>Maaş:</span> <span class="font-mono text-white">${salaryDisplayNow}</span></div>
                                        <div class="text-sm text-slate-300 flex justify-between"><span>Fiyat:</span> <span class="font-mono text-white">${priceDisplayNow}</span></div>
                                    </div>
                                    <div class="mt-3 pt-3 border-t border-slate-700">
                                        <div class="text-3xl font-black text-white">${countNow} <span class="text-sm font-medium text-slate-400">${itemLabels[key].unit}</span></div>
                                        <div class="text-[10px] text-slate-500">Alım Gücü</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex-1 min-h-[240px] flex items-center justify-center bg-slate-800/30 rounded-xl p-4 border border-slate-700/30">
                            <canvas id="${canvasId}"></canvas>
                        </div>
                     </div>
                </div>`;
                
                chartsContainer.innerHTML += html;
            });

            currentShareText += "\nSizce alım gücüm azaldı mı?";

            // Init Charts (Delayed to ensure DOM is ready)
            setTimeout(() => {
                selectedItems.forEach((key, index) => {
                    const pricePast = historicalData[selectedYear].items[key];
                    if (!pricePast || pricePast === 0) return; // Skip logic for missing data

                    const canvasId = `canvas-${index}`;
                    const priceNow = historicalData[currentYear].items[key];
                    const countPast = (salaryPast / pricePast).toFixed(2);
                    const countNow = (salaryNow / priceNow).toFixed(2);
                    
                    createChart(canvasId, selectedYear, currentYear, countPast, countNow, itemLabels[key].label);
                });
            }, 50);

            // GRID CARDS
            const grid = document.getElementById('itemsGrid');
            grid.innerHTML = '';
            
            selectedItems.forEach(key => {
                const pPast = historicalData[selectedYear].items[key];
                if (!pPast || pPast === 0) return;

                const pNow = historicalData[currentYear].items[key];
                const cPast = (salaryPast / pPast).toFixed(1);
                const cNow = (salaryNow / pNow).toFixed(1);
                const diff = cNow - cPast;
                const isPositive = diff >= 0;

                const cardHtml = `
                    <div class="bg-white dark:bg-slate-800 rounded-xl p-5 border border-slate-200 dark:border-slate-700 shadow-sm hover:shadow-md transition-all">
                        <div class="flex justify-between items-start mb-3">
                             <div class="font-bold text-sm text-slate-700 dark:text-slate-200 flex items-center gap-2">
                                <i class="${itemLabels[key].icon} text-slate-400 dark:text-slate-500"></i> ${itemLabels[key].label}
                             </div>
                             <div class="text-xs ${isPositive ? 'text-green-700 bg-green-100 dark:bg-green-900/30 dark:text-green-400' : 'text-red-700 bg-red-100 dark:bg-red-900/30 dark:text-red-400'} px-2 py-1 rounded-md font-bold">
                                ${isPositive ? '+' : ''}${diff.toFixed(1)}
                             </div>
                        </div>
                        <div class="flex justify-between text-xs text-slate-500 dark:text-slate-400 border-t border-slate-100 dark:border-slate-700 pt-3">
                            <div><span class="block text-[10px] uppercase text-slate-400 dark:text-slate-500">${selectedYear}</span><span class="font-bold text-slate-800 dark:text-slate-200 text-sm">${cPast}</span></div>
                            <div class="text-right"><span class="block text-[10px] uppercase text-slate-400 dark:text-slate-500">2026</span><span class="font-bold text-slate-800 dark:text-slate-200 text-sm">${cNow}</span></div>
                        </div>
                    </div>
                `;
                grid.innerHTML += cardHtml;
            });
            
            document.getElementById('resultsArea').scrollIntoView({ behavior: 'smooth' });
        }

        // --- CHART GENERATOR ---
        function createChart(canvasId, yearPast, yearNow, valPast, valNow, label) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [yearPast, yearNow],
                    datasets: [{
                        label: `Alım Gücü`,
                        data: [valPast, valNow],
                        backgroundColor: ['#f97316', '#e2e8f0'],
                        borderRadius: 6,
                        barThickness: 32,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y', 
                    plugins: {
                        legend: { display: false },
                        tooltip: { 
                            backgroundColor: '#0f172a',
                            padding: 12,
                            displayColors: false,
                            callbacks: { label: (c) => c.raw + ' Adet/Birim' }
                        }
                    },
                    scales: {
                        x: { grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#94a3b8' } },
                        y: { grid: { display: false }, ticks: { color: '#f8fafc', font: {weight:'600'} } }
                    }
                }
            });
        }

        // --- HELPERS ---
        function formatMoney(amount, year) {
            if (parseInt(year) < 2005) {
                const oldAmount = amount * 1000000;
                return new Intl.NumberFormat('tr-TR').format(oldAmount) + " TL";
            }
            return new Intl.NumberFormat('tr-TR', { maximumFractionDigits: 2 }).format(amount) + " TL";
        }

        function shareResult(platform) {
            const text = encodeURIComponent(currentShareText + "\nhttps://finansalhafiza.app");
            const urls = {
                twitter: `https://twitter.com/intent/tweet?text=${text}`,
                facebook: `https://www.facebook.com/sharer/sharer.php?u=https://finansalhafiza.app&quote=${text}`,
                whatsapp: `https://wa.me/?text=${text}`,
                linkedin: `https://www.linkedin.com/sharing/share-offsite/?url=https://finansalhafiza.app`
            };
            window.open(urls[platform], '_blank');
        }

        function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
        function closeModal(id) { document.getElementById(id).classList.add('hidden'); }

        window.onload = function() {
            initFilters();
            ['premiumModal', 'errorModal'].forEach(id => {
                const modal = document.getElementById(id);
                if (modal) {
                    modal.addEventListener('click', function(e) {
                        if(e.target === this) closeModal(id);
                    });
                }
            });
        };
    </script>
</body>
</html>